# URL Shortener Service

ä¸€ä¸ªç®€å•é«˜æ•ˆçš„ URL çŸ­é“¾æ¥æœåŠ¡ï¼Œå¯ä»¥å°†é•¿ URL è½¬æ¢ä¸ºçŸ­é“¾æ¥ï¼Œå¹¶æä¾›è®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ å¿«é€Ÿ URL çŸ­é“¾æ¥ç”Ÿæˆ
- ğŸ“Š è®¿é—®ç»Ÿè®¡è·Ÿè¸ª
- ğŸ“ˆ é«˜çº§ç»Ÿè®¡åˆ†æï¼ˆåœ°ç†åˆ†å¸ƒã€è®¾å¤‡ç±»å‹ã€æµè§ˆå™¨ç»Ÿè®¡ã€è®¿é—®æ¥æºç­‰ï¼‰
- ğŸ”— ä¸€é”®é‡å®šå‘
- ğŸ›¡ï¸ SQLite æ•°æ®åº“å­˜å‚¨
- ğŸŒ RESTful API æ¥å£
- â° é“¾æ¥æœ‰æ•ˆæœŸæ§åˆ¶ï¼ˆ24å°æ—¶ã€7å¤©ã€30å¤©ç­‰ï¼‰
- ğŸ¯ è‡ªå®šä¹‰çŸ­ç åŠŸèƒ½ï¼ˆæ”¯æŒå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦ï¼‰
- ğŸ—‘ï¸ è‡ªåŠ¨æ¸…ç†è¿‡æœŸé“¾æ¥
- ğŸ” è®¿é—®è€…åˆ†æï¼ˆIPåœ°å€ã€åœ°ç†ä½ç½®ã€è®¾å¤‡ä¿¡æ¯ã€æµè§ˆå™¨ç±»å‹ç­‰ï¼‰
- ğŸ“… æ—¶é—´ç»´åº¦åˆ†æï¼ˆæ¯æ—¥ã€æ¯å°æ—¶è®¿é—®è¶‹åŠ¿ï¼‰
- ğŸ”’ ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œè¾“å…¥éªŒè¯
- ğŸ›¡ï¸ å¹¶å‘å®‰å…¨ä¿è¯
- ğŸ“‹ å¥åº·æ£€æŸ¥ç«¯ç‚¹

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go
- **Web æ¡†æ¶**: Gin
- **æ•°æ®åº“**: SQLite
- **ç¼–ç **: Base62

## API æ¥å£

### åˆ›å»ºçŸ­é“¾æ¥ï¼ˆæ”¯æŒè‡ªå®šä¹‰çŸ­ç å’Œè¿‡æœŸæ—¶é—´ï¼‰
```
POST /api/shorten
Content-Type: application/json

{
  "url": "https://www.example.com/very/long/url",
  "custom_code": "mycode",      // å¯é€‰ï¼šè‡ªå®šä¹‰çŸ­ç 
  "expire_in": 24               // å¯é€‰ï¼šè¿‡æœŸæ—¶é—´ï¼ˆå°æ—¶ï¼‰ï¼Œ0è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ
}
```

å“åº”ï¼š
```json
{
  "short_url": "http://localhost:8080/a1b2c3",
  "code": "a1b2c3",
  "original": "https://www.example.com/very/long/url",
  "created_at": "2026-01-27T10:00:00Z",
  "expires_at": "2026-01-28T10:00:00Z"
}
```

### é‡å®šå‘åˆ°åŸå§‹é“¾æ¥
```
GET /{short_code}
```

### è·å–çŸ­é“¾æ¥ç»Ÿè®¡ä¿¡æ¯
```
GET /api/stats/{short_code}
```

å“åº”ï¼š
```json
{
  "original_url": "https://www.example.com/very/long/url",
  "short_code": "a1b2c3",
  "clicks": 150,
  "created_at": "2026-01-27T10:00:00Z",
  "expires_at": "2026-01-28T10:00:00Z",
  "is_active": true
}
```

### è·å–é«˜çº§åˆ†ææ•°æ®
```
GET /api/analytics/{short_code}[?since=2026-01-01&until=2026-01-31]
```

å“åº”ï¼š
```json
{
  "total_visits": 150,
  "unique_visitors": 120,
  "geographic_distribution": {
    "China": 80,
    "United States": 40,
    "Other": 30
  },
  "device_types": {
    "mobile": 90,
    "desktop": 50,
    "tablet": 10
  },
  "daily_trend": [
    {
      "date": "2026-01-27",
      "visits": 25
    }
  ]
}
```

### è·å–æœ€è¿‘è®¿é—®è®°å½•
```
GET /api/visits/{short_code}?limit=50&since=2026-01-01
```

å“åº”ï¼š
```json
{
  "visits": [
    {
      "timestamp": "2026-01-27T10:00:00Z",
      "ip_address": "192.168.1.1",
      "user_agent": "Mozilla/5.0...",
      "referer": "https://www.google.com"
    }
  ]
}
```

### å¥åº·æ£€æŸ¥
```
GET /health
```

å“åº”ï¼š
```json
{
  "status": "healthy",
  "message": "URL shortener service is running",
  "timestamp": 1706323200
}
```

## é¡¹ç›®ç»“æ„

```
url-shortener/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go             # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ model/                  # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ url.go              # URLå®ä½“å®šä¹‰
â”‚   â”‚   â””â”€â”€ analytics.go        # åˆ†ææ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ service/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ shortener.go        # åŸºç¡€çŸ­é“¾æ¥æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ enhanced_shortener.go # å¢å¼ºçŸ­é“¾æ¥æœåŠ¡
â”‚   â”‚   â””â”€â”€ analytics_service.go # åˆ†ææœåŠ¡
â”‚   â”œâ”€â”€ handler/                # HTTPå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ handler.go          # åŸºç¡€å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ enhanced_handler.go # å¢å¼ºå¤„ç†å™¨
â”‚   â”œâ”€â”€ repository/             # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ url_repo.go         # URLæ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ analytics_repo.go   # åˆ†ææ•°æ®è®¿é—®
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ errors.go           # é”™è¯¯å®šä¹‰å’Œå¤„ç†
â”‚   â”‚   â”œâ”€â”€ validation.go       # è¾“å…¥éªŒè¯
â”‚   â”‚   â””â”€â”€ user_agent_parser.go # ç”¨æˆ·ä»£ç†è§£æ
â”‚   â””â”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ config.go           # åº”ç”¨é…ç½®
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

## éƒ¨ç½²

### ç¯å¢ƒå˜é‡

- `PORT`: æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ 8080
- `DATABASE_URL`: æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œé»˜è®¤ä½¿ç”¨æœ¬åœ°SQLite
- `BASE_URL`: åŸºç¡€URLï¼Œç”¨äºç”ŸæˆçŸ­é“¾æ¥

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t url-shortener .

# è¿è¡Œå®¹å™¨
docker run -d -p 8080:8080 -e BASE_URL=http://your-domain.com url-shortener
```

### ç›´æ¥è¿è¡Œ

```bash
# å®‰è£…ä¾èµ–
go mod tidy

# è¿è¡ŒæœåŠ¡
go run cmd/server/main.go
```

## å®‰å…¨è€ƒè™‘

- è¾“å…¥éªŒè¯ï¼šæ‰€æœ‰è¾“å…¥éƒ½ä¼šç»è¿‡ä¸¥æ ¼éªŒè¯
- çŸ­ç ç”Ÿæˆï¼šä½¿ç”¨åŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
- é€Ÿç‡é™åˆ¶ï¼šé˜²æ­¢æ»¥ç”¨
- SQL æ³¨å…¥é˜²æŠ¤ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- XSS é˜²æŠ¤ï¼šè¾“å‡ºè½¬ä¹‰

## æ€§èƒ½ä¼˜åŒ–

- æ•°æ®åº“ç´¢å¼•ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
- è¿æ¥æ± ï¼šä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
- å¼‚æ­¥æ“ä½œï¼šç‚¹å‡»è®¡æ•°ç­‰éå…³é”®æ“ä½œå¼‚æ­¥æ‰§è¡Œ
- ç¼“å­˜ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜

## é”™è¯¯å¤„ç†

- ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- ä¼˜é›…çš„é”™è¯¯æ¢å¤